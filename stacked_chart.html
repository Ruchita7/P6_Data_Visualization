<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <script src="https://d3js.org/d3.v4.min.js"></script>
	  
	  <style>
	  
	  h2.header-align {
		text-align: center;
	}
	  </style>
      <script type="text/javascript">
		 var margin = 90,
              width = 1400 - margin,
              height = 600 - margin;
		 var colors = ["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"];
         var z = d3.scaleOrdinal().range(colors);
          		  
		 var x = d3.scaleBand()
           .rangeRound([margin, width])
           .paddingInner(0.05)
           .align(0.1);
               
         var y = d3.scaleLinear()
					.rangeRound([height, margin]);	
				
		 function draw(data) {
         data.sort(function(a, b) { return b.total - a.total; });
               
         var keys = data.columns.slice(1);
         
        var svg = d3.select("#chart_container")
           .append("svg")
           .attr("width", width + margin)
           .attr("height", height + margin)
           .append('g')
           .attr('class','chart');
         
         d3.select("svg")
           .selectAll("g")
           .data(d3.stack().keys(keys)(data))
           .enter().append("g")
           .attr("fill", function(d) { return z(d.key); });	
         
		 var tooltip = d3.select("#chart_container")
           .append("div")
           .attr("class", "tooltip")
           .style("position", "absolute")
           .style("z-index", "1000")
           .style("visibility", "hidden")
                    
         x.domain(data.map(function(d) { return d.Country; }));
         y.domain([0, d3.max(data, function(d) { return d.total; })]).nice();
         z.domain(keys);
         
         var groups =  d3.select("svg")
           .append("g")
           .selectAll("g")
           .data(d3.stack().keys(keys)(data))
           .enter().append("g")
           .attr("fill", function(d) { return z(d.key); });
         
         var rect = groups.selectAll("rect")
           .data(function(d) { return d; })
           .enter().append("rect")
           .attr("x", function(d) { return x(d.data.Country); })
           .attr("y", function(d) { debugger;return y(d[1]); })
           .attr("height", function(d) { return y(d[0]) - y(d[1]); })
           .attr("width", x.bandwidth())
           .on("mouseover", function(){return tooltip.style("visibility", "visible");})
           .on("mousemove", function(d){
				var text="<span style='font-weight:bold'>"+d.data["Country"]+"</span>"+
				"<br/>None: "+d.data["None"]+
				"<br/>ISCED 1: "+d.data["ISCED 1"]+
				"<br/>ISCED 2: "+d.data["ISCED 2"]+
				"<br/>ISCED 3A,4: "+d.data["ISCED 3A,ISCED 4"]+
				"<br/>ISCED 3B,C: "+d.data["ISCED 3B,C"]+
				"<br/>ISCED 5A,6: "+d.data["ISCED 5A,6"]+
				"<br/>ISCED 5B: "+d.data["ISCED 5B"];
				return tooltip.style("top", (d3.event.pageY-10)+"px")
           .style("left",(d3.event.pageX+10)+"px")
           .style("background-color","white")
           .html(text);})
           .on("mouseout", function(){return tooltip.style("visibility", "hidden");})
           .on("mouseout", function(d){return tooltip.style("visibility", "hidden");});
         
         
         d3.select("svg")
		   .append("g")
           .attr("class", "axis")
           .attr("transform", "translate(0," + height + ")")
           .call(d3.axisBottom(x))
           .selectAll("text")
           .attr("y", 0)
           .attr("x", 9)
           .attr("dy", ".35em")
           .attr("transform", "rotate(45)")
           .style("text-anchor", "start");
         
         d3.select("svg")
		   .append("g")
           .attr("class", "axis")
           .attr("transform", "translate(" + margin + ",0)")
           .call(d3.axisLeft(y).ticks(null, "s"))
           .append("text")
		   .attr("x", 2)
           .attr("y", y(y.ticks().pop()) + 0.5)
           .attr("dy", "0.32em")
           .attr("fill", "#000")
           .attr("font-weight", "bold")
           .attr("text-anchor", "start")
           .text("Maths score");		 
         
        var legend = d3.select("svg")
		  .append("g")
          .attr("font-family", "sans-serif")
          .attr("font-size", 10)
          .attr("text-anchor", "end")
          .selectAll("g")
          .data(keys.slice().reverse())
          .enter()
		  .append("g")
          .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });
         
        legend.append("rect")
          .attr("x", width - 19)
          .attr("width", 19)
          .attr("height", 19)
          .attr("fill", z);
         
         legend.append("text")
		  .attr("x", width - 24)
          .attr("y", 9.5)
          .attr("dy", "0.32em")
          .text(function(d) { return d; });
         
         }
		 
		 
		
      </script>
   </head>
   <body>


	<form>
		<label><input type="radio" name="mode" value="father" style="margin-left:100px">Father's Education</label>
		<label><input type="radio" name="mode" value="mother" checked>Mother's Education</label>
	</form>
  
	<div id="chart_container"></div>
      <script type="text/javascript">
	 
	 
		d3.csv("maths_grade_mother_education.csv", function(d, i, columns) {
		    d3.select("#chart_container").selectAll("*").remove();
			d3.select("#chart_container").append("h2").attr("class", "header-align").html("Maths grade based on Mother's education level");
			for (i = 1, t = 0; i < columns.length; ++i) t += d[columns[i]] = +d[columns[i]];
				d.total = t;
				return d;
			}, draw);

		d3.selectAll("input")
			.on("change", changed);
	
		function changed() {
			d3.select("#chart_container").selectAll("*").remove();
			if (this.value === "father") {			
				d3.select("#chart_container").append("h2").attr("class", "header-align").html("Maths grade based on Father's education level").style("align:center");
				d3.csv("maths_grade_father_education.csv", function(d, i, columns) {
		
				for (i = 1, t = 0; i < columns.length; ++i) t += d[columns[i]] = +d[columns[i]];
					d.total = t;
					return d;
				}, draw);

			}
		else  {
			d3.select("#chart_container").append("h2").attr("class", "header-align").html("Maths grade based on Mother's education level").style("align:center");
			d3.csv("maths_grade_mother_education.csv", function(d, i, columns) {		
			for (i = 1, t = 0; i < columns.length; ++i) t += d[columns[i]] = +d[columns[i]];
				d.total = t;
				return d;
			}, draw);
	
	}	
		}
      </script>
   </body>
</html>